TRANSLATIONS = {
    "en": {
        "auth.invalid_credentials": "Invalid email or password",
        "auth.user_inactive": "User account is inactive",
        "auth.token_expired": "Token has expired",
        "auth.insufficient_permissions": "Insufficient permissions",
        "user.not_found": "User not found",
        "user.email_exists": "Email already registered",
        "user.username_exists": "Username already taken",
        "user.created": "User created successfully",
        "user.updated": "User updated successfully",
        "user.deleted": "User deleted successfully",
        "role.not_found": "Role not found",
        "role.name_exists": "Role name already exists",
        "agent.not_found": "Agent not found",
        "agent.slug_exists": "Agent slug already exists",
        "agent.exported": "Agent exported successfully",
        "agent.imported": "Agent imported successfully",
        "agent.duplicated": "Agent duplicated successfully",
        "quota.exceeded": "Quota exceeded",
        "quota.not_found": "Quota not found",
        "provider.not_found": "Provider not found",
        "moderation.blocked": "Content blocked by moderation rules",
        "system.update_available": "Update available",
        "system.up_to_date": "System is up to date",
        # Agent Creator — progress
        "agent_creator.generating": "Generating agent files...",
        "agent_creator.validation_passed": "All generated files passed validation",
        "agent_creator.validation_failed": "Generated files have validation errors",
        "agent_creator.stored": "Agent files stored successfully",
        "agent_creator.invalid_slug": "Invalid agent slug format",
        "agent_creator.progress.loading_prompt": "Loading system prompt...",
        "agent_creator.progress.loading_history": "Loading conversation history...",
        "agent_creator.progress.generating": "Generating response...",
        "agent_creator.progress.processing": "Processing response...",
        "agent_creator.progress.validating": "Validating generated code...",
        "agent_creator.progress.done": "Done",
        # Agent Creator — validation errors
        "agent_creator.val.missing_manifest": "Missing backend/manifest.json",
        "agent_creator.val.manifest_missing_field": "manifest.json missing required field: {field}",
        "agent_creator.val.invalid_slug": "Invalid slug format: {slug}",
        "agent_creator.val.manifest_invalid_json": "manifest.json is not valid JSON: {detail}",
        "agent_creator.val.missing_agent": "Missing backend/agent.py",
        "agent_creator.val.no_base_agent": "agent.py must extend BaseAgent",
        "agent_creator.val.no_handle_message": "agent.py must implement handle_message()",
        "agent_creator.val.no_docstrings": "agent.py should have docstrings",
        "agent_creator.val.forbidden_import": "Forbidden import in agent.py: {name}",
        "agent_creator.val.forbidden_builtin": "Forbidden builtin in agent.py: {name}",
        "agent_creator.val.missing_system_md": "Missing backend/prompts/system.md",
        "agent_creator.val.system_md_short": "system.md seems too short — consider adding more instructions",
        "agent_creator.val.missing_frontend": "Missing frontend/index.tsx",
        "agent_creator.val.no_default_export": "index.tsx must have a default export",
        "agent_creator.val.no_agent_view_props": "index.tsx must implement AgentViewProps",
        "agent_creator.val.forbidden_frontend_import": "Forbidden import in index.tsx: {name}",
        "agent_creator.val.validation_warnings": "Validation warnings:",
    },
    "fr": {
        "auth.invalid_credentials": "Email ou mot de passe invalide",
        "auth.user_inactive": "Le compte utilisateur est inactif",
        "auth.token_expired": "Le jeton a expiré",
        "auth.insufficient_permissions": "Permissions insuffisantes",
        "user.not_found": "Utilisateur introuvable",
        "user.email_exists": "Cet email est déjà enregistré",
        "user.username_exists": "Ce nom d'utilisateur est déjà pris",
        "user.created": "Utilisateur créé avec succès",
        "user.updated": "Utilisateur mis à jour avec succès",
        "user.deleted": "Utilisateur supprimé avec succès",
        "role.not_found": "Rôle introuvable",
        "role.name_exists": "Ce nom de rôle existe déjà",
        "agent.not_found": "Agent introuvable",
        "agent.slug_exists": "Ce slug d'agent existe déjà",
        "agent.exported": "Agent exporté avec succès",
        "agent.imported": "Agent importé avec succès",
        "agent.duplicated": "Agent dupliqué avec succès",
        "quota.exceeded": "Quota dépassé",
        "quota.not_found": "Quota introuvable",
        "provider.not_found": "Fournisseur introuvable",
        "moderation.blocked": "Contenu bloqué par les règles de modération",
        "system.update_available": "Mise à jour disponible",
        "system.up_to_date": "Le système est à jour",
        # Agent Creator — progress
        "agent_creator.generating": "Génération des fichiers de l'agent...",
        "agent_creator.validation_passed": "Tous les fichiers générés ont passé la validation",
        "agent_creator.validation_failed": "Les fichiers générés contiennent des erreurs de validation",
        "agent_creator.stored": "Fichiers de l'agent stockés avec succès",
        "agent_creator.invalid_slug": "Format de slug d'agent invalide",
        "agent_creator.progress.loading_prompt": "Chargement du prompt système...",
        "agent_creator.progress.loading_history": "Chargement de l'historique...",
        "agent_creator.progress.generating": "Génération de la réponse...",
        "agent_creator.progress.processing": "Traitement de la réponse...",
        "agent_creator.progress.validating": "Validation du code généré...",
        "agent_creator.progress.done": "Terminé",
        # Agent Creator — validation errors
        "agent_creator.val.missing_manifest": "Fichier backend/manifest.json manquant",
        "agent_creator.val.manifest_missing_field": "Champ requis manquant dans manifest.json : {field}",
        "agent_creator.val.invalid_slug": "Format de slug invalide : {slug}",
        "agent_creator.val.manifest_invalid_json": "manifest.json n'est pas un JSON valide : {detail}",
        "agent_creator.val.missing_agent": "Fichier backend/agent.py manquant",
        "agent_creator.val.no_base_agent": "agent.py doit étendre BaseAgent",
        "agent_creator.val.no_handle_message": "agent.py doit implémenter handle_message()",
        "agent_creator.val.no_docstrings": "agent.py devrait contenir des docstrings",
        "agent_creator.val.forbidden_import": "Import interdit dans agent.py : {name}",
        "agent_creator.val.forbidden_builtin": "Builtin interdit dans agent.py : {name}",
        "agent_creator.val.missing_system_md": "Fichier backend/prompts/system.md manquant",
        "agent_creator.val.system_md_short": "system.md semble trop court — ajoutez plus d'instructions",
        "agent_creator.val.missing_frontend": "Fichier frontend/index.tsx manquant",
        "agent_creator.val.no_default_export": "index.tsx doit avoir un export par défaut",
        "agent_creator.val.no_agent_view_props": "index.tsx doit implémenter AgentViewProps",
        "agent_creator.val.forbidden_frontend_import": "Import interdit dans index.tsx : {name}",
        "agent_creator.val.validation_warnings": "Avertissements de validation :",
    },
    "es": {
        "auth.invalid_credentials": "Correo electrónico o contraseña inválidos",
        "auth.user_inactive": "La cuenta de usuario está inactiva",
        "auth.token_expired": "El token ha expirado",
        "auth.insufficient_permissions": "Permisos insuficientes",
        "user.not_found": "Usuario no encontrado",
        "user.email_exists": "El correo electrónico ya está registrado",
        "user.username_exists": "El nombre de usuario ya está en uso",
        "user.created": "Usuario creado exitosamente",
        "user.updated": "Usuario actualizado exitosamente",
        "user.deleted": "Usuario eliminado exitosamente",
        "role.not_found": "Rol no encontrado",
        "role.name_exists": "El nombre del rol ya existe",
        "agent.not_found": "Agente no encontrado",
        "agent.slug_exists": "El slug del agente ya existe",
        "agent.exported": "Agente exportado exitosamente",
        "agent.imported": "Agente importado exitosamente",
        "agent.duplicated": "Agente duplicado exitosamente",
        "quota.exceeded": "Cuota excedida",
        "quota.not_found": "Cuota no encontrada",
        "provider.not_found": "Proveedor no encontrado",
        "moderation.blocked": "Contenido bloqueado por reglas de moderación",
        "system.update_available": "Actualización disponible",
        "system.up_to_date": "El sistema está actualizado",
        # Agent Creator — progress
        "agent_creator.generating": "Generando archivos del agente...",
        "agent_creator.validation_passed": "Todos los archivos generados pasaron la validación",
        "agent_creator.validation_failed": "Los archivos generados contienen errores de validación",
        "agent_creator.stored": "Archivos del agente almacenados exitosamente",
        "agent_creator.invalid_slug": "Formato de slug de agente inválido",
        "agent_creator.progress.loading_prompt": "Cargando prompt del sistema...",
        "agent_creator.progress.loading_history": "Cargando historial de conversación...",
        "agent_creator.progress.generating": "Generando respuesta...",
        "agent_creator.progress.processing": "Procesando respuesta...",
        "agent_creator.progress.validating": "Validando código generado...",
        "agent_creator.progress.done": "Listo",
        # Agent Creator — validation errors
        "agent_creator.val.missing_manifest": "Falta backend/manifest.json",
        "agent_creator.val.manifest_missing_field": "Campo requerido faltante en manifest.json: {field}",
        "agent_creator.val.invalid_slug": "Formato de slug inválido: {slug}",
        "agent_creator.val.manifest_invalid_json": "manifest.json no es un JSON válido: {detail}",
        "agent_creator.val.missing_agent": "Falta backend/agent.py",
        "agent_creator.val.no_base_agent": "agent.py debe extender BaseAgent",
        "agent_creator.val.no_handle_message": "agent.py debe implementar handle_message()",
        "agent_creator.val.no_docstrings": "agent.py debería tener docstrings",
        "agent_creator.val.forbidden_import": "Importación prohibida en agent.py: {name}",
        "agent_creator.val.forbidden_builtin": "Builtin prohibido en agent.py: {name}",
        "agent_creator.val.missing_system_md": "Falta backend/prompts/system.md",
        "agent_creator.val.system_md_short": "system.md parece demasiado corto — considere agregar más instrucciones",
        "agent_creator.val.missing_frontend": "Falta frontend/index.tsx",
        "agent_creator.val.no_default_export": "index.tsx debe tener un export por defecto",
        "agent_creator.val.no_agent_view_props": "index.tsx debe implementar AgentViewProps",
        "agent_creator.val.forbidden_frontend_import": "Importación prohibida en index.tsx: {name}",
        "agent_creator.val.validation_warnings": "Advertencias de validación:",
    },
}


def t(key: str, lang: str = "en", **kwargs: str) -> str:
    text = TRANSLATIONS.get(lang, TRANSLATIONS["en"]).get(key, key)
    if kwargs:
        for k, v in kwargs.items():
            text = text.replace(f"{{{k}}}", str(v))
    return text
